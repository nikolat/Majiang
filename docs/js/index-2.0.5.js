(()=>{"use strict";var i={835:(i,e,t)=>{t.d(e,{B0:()=>l,B_:()=>d,Q7:()=>o,_P:()=>n});const s="http://localhost:9801";async function a(i){let e="NOTIFY SSTP/1.1\nCharset: UTF-8\nSender: Majiang\nSecurityLevel: local\nEvent: OnMahjong\nOption: nobreak\nReceiverGhostHWnd: "+i[0]+"\nReference0: UKAJONG/0.2\n";for(let t=1;t<i.length;t++)e+="Reference"+t+": "+i[t]+"\n";e+="\n";const t=await h(s+"/api/sstp/v1",e);console.log(e),console.log("----------"),console.log(t),console.log("----------")}async function h(i="",e=""){const t={method:"POST",headers:{"Content-Type":"text/plain",Origin:s},body:e};try{return(await fetch(i,t)).text()}catch(i){return console.log(i),""}}async function l(){const i="EXECUTE SSTP/1.1\nCharset: UTF-8\nSecurityLevel: external\nCommand: GetFMO\n\n",e=await h(s+"/api/sstp/v1",i);console.log(i),console.log("----------"),console.log(e),console.log("----------");const t=e.split("\r\n"),a=[],l=[];for(let i=0;i<t.length;i++)if(t[i].indexOf(".hwnd"+String.fromCharCode(1))>=0){const e=t[i].split(String.fromCharCode(1))[1].replace("\r","");a.push(e)}else if(t[i].indexOf(".name"+String.fromCharCode(1))>=0){const e=t[i].split(String.fromCharCode(1))[1].replace("\r","");l.push(e)}const n=[],o=[],d={};for(let i=0;i<l.length;i++){d[l[i]]=a[i];const e="NOTIFY SSTP/1.1\nCharset: UTF-8\nSender: Majiang\nSecurityLevel: local\nEvent: OnMahjong\nOption: nobreak\nReceiverGhostHWnd: "+a[i]+"\nReference0: UKAJONG/0.2\nReference1: hello\n\n",t=await h(s+"/api/sstp/v1",e);console.log(e),console.log("----------"),console.log(t),console.log("----------");const r=t.split("\r\n");for(let i=0;i<r.length;i++)if(r[i].indexOf("X-SSTP-PassThru-Reference3: name=")>=0){const e=r[i].split("X-SSTP-PassThru-Reference3: name=")[1].replace("\r","");o.push(e),n.push(d[e])}}return[o,n]}class n extends Majiang.Game{constructor(i,e,t,s,a,h){super(i,e,t,s);for(let i=0;i<a.length;i++){let e=(i+1)%4;if(this._model.player[e]=a[i],this._players[e]._hwnd=h[i],3==i)break}}reply_zimo(){let i=this._model,e=this.get_reply(i.lunban);if(e.daopai){if(this.allow_pingju()){let e=["","","",""];return e[i.lunban]=i.shoupai[i.lunban].toString(),this.delay((()=>this.pingju("九種九牌",e)),0)}}else if(e.hule){if(this.allow_hule()){this._view&&this._view.say("zimo",i.lunban);for(let i=0;i<4;i++)this._players[i]._hwnd&&a([this._players[i]._hwnd,"say",this._model.player[this._model.player_id[this._model.lunban]],"tsumo"]);return this.delay((()=>this.hule()))}}else if(e.gang){if(this.get_gang_mianzi().find((i=>i==e.gang))){this._view&&this._view.say("gang",i.lunban);for(let i=0;i<4;i++)this._players[i]._hwnd&&a([this._players[i]._hwnd,"say",this._model.player[this._model.player_id[this._model.lunban]],"kan"]);return this.delay((()=>this.gang(e.gang)))}}else if(e.dapai){let t=e.dapai.replace(/\*$/,"");if(this.get_dapai().find((i=>i==t))){if("*"==e.dapai.substr(-1)&&this.allow_lizhi(t)){this._view&&this._view.say("lizhi",i.lunban);for(let i=0;i<4;i++)this._players[i]._hwnd&&a([this._players[i]._hwnd,"say",this._model.player[this._model.player_id[this._model.lunban]],"richi"]);return this.delay((()=>this.dapai(e.dapai)))}return this.delay((()=>this.dapai(t)),0)}}let t=this.get_dapai().pop();this.delay((()=>this.dapai(t)),0)}reply_dapai(){let i=this._model;for(let e=1;e<4;e++){let t=(i.lunban+e)%4;if(this.get_reply(t).hule&&this.allow_hule(t)){if(1==this._rule["最大同時和了数"]&&this._hule.length)continue;this._view&&this._view.say("rong",t);for(let i=0;i<4;i++)this._players[i]._hwnd&&a([this._players[i]._hwnd,"say",this._model.player[this._model.player_id[t]],"ron"]);this._hule.push(t)}else{let e=i.shoupai[t].clone().zimo(this._dapai);-1==Majiang.Util.xiangting(e)&&(this._neng_rong[t]=!1)}}if(3==this._hule.length&&2==this._rule["最大同時和了数"]){let e=["","","",""];for(let t of this._hule)e[t]=i.shoupai[t].toString();return this.delay((()=>this.pingju("三家和",e)))}if(this._hule.length)return this.delay((()=>this.hule()));if("*"==this._dapai.substr(-1)&&(i.defen[i.player_id[i.lunban]]-=1e3,i.lizhibang++,4==this._lizhi.filter((i=>i)).length&&this._rule["途中流局あり"])){let e=i.shoupai.map((i=>i.toString()));return this.delay((()=>this.pingju("四家立直",e)))}if(this._diyizimo&&3==i.lunban&&(this._diyizimo=!1,this._fengpai))return this.delay((()=>this.pingju("四風連打")),0);if(4==this._n_gang.reduce(((i,e)=>i+e))&&Math.max(...this._n_gang)<4&&this._rule["途中流局あり"])return this.delay((()=>this.pingju("四開槓")),0);if(!i.shan.paishu){let i=["","","",""];for(let e=0;e<4;e++){let t=this.get_reply(e);t.daopai&&(i[e]=t.daopai)}return this.delay((()=>this.pingju("",i)),0)}for(let e=1;e<4;e++){let t=(i.lunban+e)%4,s=this.get_reply(t);if(s.fulou){let i=s.fulou.replace(/0/g,"5");if(i.match(/^[mpsz](\d)\1\1\1/)){if(this.get_gang_mianzi(t).find((i=>i==s.fulou))){this._view&&this._view.say("gang",t);for(let i=0;i<4;i++)this._players[i]._hwnd&&a([this._players[i]._hwnd,"say",this._model.player[this._model.player_id[t]],"kan"]);return this.delay((()=>this.fulou(s.fulou)))}}else if(i.match(/^[mpsz](\d)\1\1/)&&this.get_peng_mianzi(t).find((i=>i==s.fulou))){this._view&&this._view.say("peng",t);for(let i=0;i<4;i++)this._players[i]._hwnd&&a([this._players[i]._hwnd,"say",this._model.player[this._model.player_id[t]],"pon"]);return this.delay((()=>this.fulou(s.fulou)))}}}let e=(i.lunban+1)%4,t=this.get_reply(e);if(t.fulou&&this.get_chi_mianzi(e).find((i=>i==t.fulou))){this._view&&this._view.say("chi",e);for(let i=0;i<4;i++)this._players[i]._hwnd&&a([this._players[i]._hwnd,"say",this._model.player[this._model.player_id[e]],"chi"]);return this.delay((()=>this.fulou(t.fulou)))}this.delay((()=>this.zimo()),0)}}class o extends Majiang.UI.Player{constructor(i,e){super(i,e)}to_ump(i){let e="",t="";for(let s=0;s<i.length;s++){let a=i.substring(s,s+1);a.match(/[_\*\-+=]/)||(a.match(/\d/)?e+=a.replace(/0/,"5")+t:t=a)}return e}from_ump(i){let e="",t="",s=-1;for(let a=0;a<i.length;a++){let h=i.substring(a,a+1);h.match(/\d/)?s=1*h:h.match(/[mpsz]/)&&(t==h?e+=s:(t=h,e+=t+s))}return e}replace_zero_if_none(i){let e=i;return"m5"==i&&0==this.shoupai._bingpai.m[5]?e="m0":"p5"==i&&0==this.shoupai._bingpai.p[5]?e="p0":"s5"==i&&0==this.shoupai._bingpai.s[5]&&(e="s0"),e}kaiju(i){super.kaiju(i),this._hwnd&&a([this._hwnd,"gamestart",["東","南","西","北"][(4+this._id-i.qijia)%4],i.player[0],i.player[1],i.player[2],i.player[3]])}qipai(i){super.qipai(i);const e=(4+this._model.menfeng(this._id)-this._id+this._model.qijia)%4,t=[this._model.player[(4-e)%4],this._model.player[(5-e)%4],this._model.player[(6-e)%4],this._model.player[(7-e)%4]];this._hwnd&&(a([this._hwnd,"kyokustart",["東","南","西","北"][i.zhuangfeng],t[this._model.qijia],i.changbang,1e3*i.lizhibang]),a([this._hwnd,"dora",this.to_ump(i.baopai)]),a([this._hwnd,"haipai",this._model.player[this._id],this.to_ump(this.shoupai.toString())]))}zimo(i,e){super.zimo(i,e);const t=(4+this._model.menfeng(this._id)-this._id+this._model.qijia)%4,s=[this._model.player[(4-t)%4],this._model.player[(5-t)%4],this._model.player[(6-t)%4],this._model.player[(7-t)%4]];this._hwnd&&i.l==this._model.menfeng(this._id)&&a([this._hwnd,"tsumo",s[(this._model.qijia+i.l)%4],this.shan.paishu,this.to_ump(i.p)])}dapai(i){super.dapai(i);const e=(4+this._model.menfeng(this._id)-this._id+this._model.qijia)%4,t=[this._model.player[(4-e)%4],this._model.player[(5-e)%4],this._model.player[(6-e)%4],this._model.player[(7-e)%4]];this._hwnd&&a([this._hwnd,"sutehai",t[(this._model.qijia+i.l)%4],this.to_ump(i.p)])}fulou(i){super.fulou(i);const e=(4+this._model.menfeng(this._id)-this._id+this._model.qijia)%4,t=[this._model.player[(4-e)%4],this._model.player[(5-e)%4],this._model.player[(6-e)%4],this._model.player[(7-e)%4]];this._hwnd&&a([this._hwnd,"open",t[(this._model.qijia+i.l)%4],this.to_ump(i.m)])}gang(i){super.gang(i);const e=(4+this._model.menfeng(this._id)-this._id+this._model.qijia)%4,t=[this._model.player[(4-e)%4],this._model.player[(5-e)%4],this._model.player[(6-e)%4],this._model.player[(7-e)%4]];this._hwnd&&(i.m.match(/^[mpsz]\d{4}/)?a([this._hwnd,"open",t[(this._model.qijia+i.l)%4],this.to_ump(i.m)]):a([this._hwnd,"open",t[(this._model.qijia+i.l)%4],this.to_ump(i.m.substr(0,2))]))}kaigang(i){super.kaigang(i),this._hwnd&&a([this._hwnd,"dora",this.to_ump(i.baopai)])}hule(i){super.hule(i);const e=(4+this._model.menfeng(this._id)-this._id+this._model.qijia)%4,t=[this._model.player[(4-e)%4],this._model.player[(5-e)%4],this._model.player[(6-e)%4],this._model.player[(7-e)%4]];if(this._hwnd){a([this._hwnd,"agari",t[(i.l+this._model.qijia)%4],i.fu]),i.fubaopai&&a([this._hwnd,"dora",this.to_ump(i.fubaopai.join(""))]);for(let e=0;e<4;e++)i.fenpei[e]&&a([this._hwnd,"point",t[(e+this._model.qijia)%4],i.fenpei[e]>0?"+":"-",Math.abs(i.fenpei[e])]);a([this._hwnd,"kyokuend"])}}pingju(i){super.pingju(i);const e=(4+this._model.menfeng(this._id)-this._id+this._model.qijia)%4,t=[this._model.player[(4-e)%4],this._model.player[(5-e)%4],this._model.player[(6-e)%4],this._model.player[(7-e)%4]];if(this._hwnd){a([this._hwnd,"ryukyoku"]);for(let e=0;e<4;e++)i.fenpei[e]&&a([this._hwnd,"point",t[(e+this._model.qijia)%4],i.fenpei[e]>0?"+":"-",Math.abs(i.fenpei[e])]);a([this._hwnd,"kyokuend"])}}jieju(i){super.jieju(i);const e=this._model.player;this._hwnd&&a([this._hwnd,"gameend",e[0]+String.fromCharCode(1)+i.defen[0],e[1]+String.fromCharCode(1)+i.defen[1],e[2]+String.fromCharCode(1)+i.defen[2],e[3]+String.fromCharCode(1)+i.defen[3]])}}class d extends Majiang.AI{to_ump(i){let e="",t="";for(let s=0;s<i.length;s++){let a=i.substring(s,s+1);a.match(/[_\*\-+=]/)||(a.match(/\d/)?e+=a.replace(/0/,"5")+t:t=a)}return e}from_ump(i){let e="",t="",s=-1;for(let a=0;a<i.length;a++){let h=i.substring(a,a+1);h.match(/\d/)?s=1*h:h.match(/[mpsz]/)&&(t==h?e+=s:(t=h,e+=t+s))}return e}replace_zero_if_none(i){let e=i;return"m5"==i&&0==this.shoupai._bingpai.m[5]?e="m0":"p5"==i&&0==this.shoupai._bingpai.p[5]?e="p0":"s5"==i&&0==this.shoupai._bingpai.s[5]&&(e="s0"),e}kaiju(i){super.kaiju(i),this._hwnd&&a([this._hwnd,"gamestart",["東","南","西","北"][(4+this._id-i.qijia)%4],i.player[0],i.player[1],i.player[2],i.player[3]])}qipai(i){super.qipai(i);const e=(4+this._model.menfeng(this._id)-this._id+this._model.qijia)%4,t=[this._model.player[(4-e)%4],this._model.player[(5-e)%4],this._model.player[(6-e)%4],this._model.player[(7-e)%4]];this._hwnd&&(a([this._hwnd,"kyokustart",["東","南","西","北"][i.zhuangfeng],t[this._model.qijia],i.changbang,1e3*i.lizhibang]),a([this._hwnd,"dora",this.to_ump(i.baopai)]),a([this._hwnd,"haipai",this._model.player[this._id],this.to_ump(this.shoupai.toString())]))}zimo(i,e){super.zimo(i,e);const t=(4+this._model.menfeng(this._id)-this._id+this._model.qijia)%4,s=[this._model.player[(4-t)%4],this._model.player[(5-t)%4],this._model.player[(6-t)%4],this._model.player[(7-t)%4]];this._hwnd&&i.l==this._model.menfeng(this._id)&&a([this._hwnd,"tsumo",s[(this._model.qijia+i.l)%4],this.shan.paishu,this.to_ump(i.p)])}dapai(i){super.dapai(i);const e=(4+this._model.menfeng(this._id)-this._id+this._model.qijia)%4,t=[this._model.player[(4-e)%4],this._model.player[(5-e)%4],this._model.player[(6-e)%4],this._model.player[(7-e)%4]];this._hwnd&&a([this._hwnd,"sutehai",t[(this._model.qijia+i.l)%4],this.to_ump(i.p)])}fulou(i){super.fulou(i);const e=(4+this._model.menfeng(this._id)-this._id+this._model.qijia)%4,t=[this._model.player[(4-e)%4],this._model.player[(5-e)%4],this._model.player[(6-e)%4],this._model.player[(7-e)%4]];this._hwnd&&a([this._hwnd,"open",t[(this._model.qijia+i.l)%4],this.to_ump(i.m)])}gang(i){super.gang(i);const e=(4+this._model.menfeng(this._id)-this._id+this._model.qijia)%4,t=[this._model.player[(4-e)%4],this._model.player[(5-e)%4],this._model.player[(6-e)%4],this._model.player[(7-e)%4]];this._hwnd&&(i.m.match(/^[mpsz]\d{4}/)?a([this._hwnd,"open",t[(this._model.qijia+i.l)%4],this.to_ump(i.m)]):a([this._hwnd,"open",t[(this._model.qijia+i.l)%4],this.to_ump(i.m.substr(0,2))]))}kaigang(i){super.kaigang(i),this._hwnd&&a([this._hwnd,"dora",this.to_ump(i.baopai)])}hule(i){super.hule(i);const e=(4+this._model.menfeng(this._id)-this._id+this._model.qijia)%4,t=[this._model.player[(4-e)%4],this._model.player[(5-e)%4],this._model.player[(6-e)%4],this._model.player[(7-e)%4]];if(this._hwnd){a([this._hwnd,"agari",t[(i.l+this._model.qijia)%4],i.fu]),i.fubaopai&&a([this._hwnd,"dora",this.to_ump(i.fubaopai.join(""))]);for(let e=0;e<4;e++)i.fenpei[e]&&a([this._hwnd,"point",t[(e+this._model.qijia)%4],i.fenpei[e]>0?"+":"-",Math.abs(i.fenpei[e])]);a([this._hwnd,"kyokuend"])}}pingju(i){super.pingju(i);const e=(4+this._model.menfeng(this._id)-this._id+this._model.qijia)%4,t=[this._model.player[(4-e)%4],this._model.player[(5-e)%4],this._model.player[(6-e)%4],this._model.player[(7-e)%4]];if(this._hwnd){a([this._hwnd,"ryukyoku"]);for(let e=0;e<4;e++)i.fenpei[e]&&a([this._hwnd,"point",t[(e+this._model.qijia)%4],i.fenpei[e]>0?"+":"-",Math.abs(i.fenpei[e])]);a([this._hwnd,"kyokuend"])}}jieju(i){super.jieju(i);const e=this._model.player;this._hwnd&&a([this._hwnd,"gameend",e[0]+String.fromCharCode(1)+i.defen[0],e[1]+String.fromCharCode(1)+i.defen[1],e[2]+String.fromCharCode(1)+i.defen[2],e[3]+String.fromCharCode(1)+i.defen[3]])}}}},e={};function t(s){var a=e[s];if(void 0!==a)return a.exports;var h=e[s]={exports:{}};return i[s](h,h.exports,t),h.exports}t.d=(i,e)=>{for(var s in e)t.o(e,s)&&!t.o(i,s)&&Object.defineProperty(i,s,{enumerable:!0,get:e[s]})},t.o=(i,e)=>Object.prototype.hasOwnProperty.call(i,e),(()=>{var i=t(835);
/*!
 *  電脳麻将 v2.0.5
 *
 *  Copyright(C) 2017 Satoshi Kobayashi
 *  Released under the MIT license
 *  https://github.com/kobalab/Majiang/blob/master/LICENSE
 */const{hide:e,show:s,fadeIn:a,scale:h,setSelector:l,clearSelector:n}=Majiang.UI.Util;let o;$((function(){let t;const d=Majiang.UI.pai($("#loaddata")),r=Majiang.UI.audio($("#loaddata")),_=i=>($("body").addClass("analyzer"),new Majiang.UI.Analyzer($("#board > .analyzer"),i,d,(()=>$("body").removeClass("analyzer")))),p=new Majiang.UI.PaipuFile($("#file"),"Majiang.game",(i=>($("body").attr("class","board"),h($("#board"),$("#space")),new Majiang.UI.Paipu($("#board"),i,d,r,"Majiang.pref",(()=>a($("body").attr("class","file"))),_))),(i=>(a($("body").attr("class","stat")),new Majiang.UI.PaipuStat($("#stat"),i,(()=>a($("body").attr("class","file"))))))),m=Majiang.rule(JSON.parse(localStorage.getItem("Majiang.rule")||"{}"));async function u(){const[e,s]=await(0,i.B0)();let a=[new Majiang.UI.Player($("#board"),d,r)];for(let e=1;e<4;e++)a[e]=new i.B_;a[0]=new i.Q7($("#board"),d,r),t=new i._P(a,g,m,null,e,s),t.view=new Majiang.UI.Board($("#board .board"),d,r,t.model),$("body").attr("class","board"),h($("#board"),$("#space")),new Majiang.UI.GameCtl($("#board"),t,"Majiang.pref"),t.kaiju()}function g(i){i&&p.add(i,10),a($("body").attr("class","file")),p.redraw()}$("#file .start").on("click",u),$(window).on("resize",(()=>h($("#board"),$("#space")))),$(window).on("load",(function(){e($("#title .loading")),$("#title .start").attr("tabindex",0).attr("role","button").on("click",(()=>{n("title"),p.isEmpty?u():g()})),s(l($("#title .start"),"title",{focus:null,touch:!1}))})),o&&$(window).trigger("load")})),$(window).on("load",(()=>o=!0))})()})();