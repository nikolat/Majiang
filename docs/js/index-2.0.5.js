(()=>{"use strict";var e={835:(e,i,t)=>{t.d(i,{B0:()=>n,B_:()=>o,_P:()=>h});const a="http://localhost:9801";async function s(e){let i="NOTIFY SSTP/1.1\nCharset: UTF-8\nSender: Majiang\nSecurityLevel: local\nEvent: OnMahjong\nOption: nobreak\nReceiverGhostHWnd: "+e[0]+"\nReference0: UKAJONG/0.2\n";for(let t=1;t<e.length;t++)i+="Reference"+t+": "+e[t]+"\n";i+="\n";const t=await l(a+"/api/sstp/v1",i);console.log(i),console.log("----------"),console.log(t),console.log("----------")}async function l(e="",i=""){const t={method:"POST",headers:{"Content-Type":"text/plain",Origin:a},body:i};try{return(await fetch(e,t)).text()}catch(e){return console.log(e),""}}async function n(){const e="EXECUTE SSTP/1.1\nCharset: UTF-8\nSecurityLevel: external\nCommand: GetFMO\n\n",i=await l(a+"/api/sstp/v1",e);console.log(e),console.log("----------"),console.log(i),console.log("----------");const t=i.split("\r\n"),s=[],n=[];for(let e=0;e<t.length;e++)if(t[e].indexOf(".hwnd"+String.fromCharCode(1))>=0){const i=t[e].split(String.fromCharCode(1))[1].replace("\r","");s.push(i)}else if(t[e].indexOf(".name"+String.fromCharCode(1))>=0){const i=t[e].split(String.fromCharCode(1))[1].replace("\r","");n.push(i)}const h=[],o=[],r={};for(let e=0;e<n.length;e++){r[n[e]]=s[e];const i="NOTIFY SSTP/1.1\nCharset: UTF-8\nSender: Majiang\nSecurityLevel: local\nEvent: OnMahjong\nOption: nobreak\nReceiverGhostHWnd: "+s[e]+"\nReference0: UKAJONG/0.2\nReference1: hello\n\n",t=await l(a+"/api/sstp/v1",i);console.log(i),console.log("----------"),console.log(t),console.log("----------");const d=t.split("\r\n");for(let e=0;e<d.length;e++)if(d[e].indexOf("X-SSTP-PassThru-Reference3: name=")>=0){const i=d[e].split("X-SSTP-PassThru-Reference3: name=")[1].replace("\r","");o.push(i),h.push(r[i])}}return[o,h]}class h extends Majiang.Game{constructor(e,i,t,a,s,l){super(e,i,t,a);for(let e=0;e<s.length;e++){let i=(e+1)%4;if(this._model.player[i]=s[e],this._players[i]._hwnd=l[e],3==e)break}}reply_zimo(){let e=this._model,i=this.get_reply(e.lunban);if(i.daopai){if(this.allow_pingju()){let i=["","","",""];return i[e.lunban]=e.shoupai[e.lunban].toString(),this.delay((()=>this.pingju("九種九牌",i)),0)}}else if(i.hule){if(this.allow_hule()){this._view&&this._view.say("zimo",e.lunban);for(let e=0;e<4;e++)this._players[e]._hwnd&&s([this._players[e]._hwnd,"say",this._model.player[this._model.player_id[this._model.lunban]],"tsumo"]);return this.delay((()=>this.hule()))}}else if(i.gang){if(this.get_gang_mianzi().find((e=>e==i.gang))){this._view&&this._view.say("gang",e.lunban);for(let e=0;e<4;e++)this._players[e]._hwnd&&s([this._players[e]._hwnd,"say",this._model.player[this._model.player_id[this._model.lunban]],"kan"]);return this.delay((()=>this.gang(i.gang)))}}else if(i.dapai){let t=i.dapai.replace(/\*$/,"");if(this.get_dapai().find((e=>e==t))){if("*"==i.dapai.substr(-1)&&this.allow_lizhi(t)){this._view&&this._view.say("lizhi",e.lunban);for(let e=0;e<4;e++)this._players[e]._hwnd&&s([this._players[e]._hwnd,"say",this._model.player[this._model.player_id[this._model.lunban]],"richi"]);return this.delay((()=>this.dapai(i.dapai)))}return this.delay((()=>this.dapai(t)),0)}}let t=this.get_dapai().pop();this.delay((()=>this.dapai(t)),0)}reply_dapai(){let e=this._model;for(let i=1;i<4;i++){let t=(e.lunban+i)%4;if(this.get_reply(t).hule&&this.allow_hule(t)){if(1==this._rule["最大同時和了数"]&&this._hule.length)continue;this._view&&this._view.say("rong",t);for(let e=0;e<4;e++)this._players[e]._hwnd&&s([this._players[e]._hwnd,"say",this._model.player[this._model.player_id[t]],"ron"]);this._hule.push(t)}else{let i=e.shoupai[t].clone().zimo(this._dapai);-1==Majiang.Util.xiangting(i)&&(this._neng_rong[t]=!1)}}if(3==this._hule.length&&2==this._rule["最大同時和了数"]){let i=["","","",""];for(let t of this._hule)i[t]=e.shoupai[t].toString();return this.delay((()=>this.pingju("三家和",i)))}if(this._hule.length)return this.delay((()=>this.hule()));if("*"==this._dapai.substr(-1)&&(e.defen[e.player_id[e.lunban]]-=1e3,e.lizhibang++,4==this._lizhi.filter((e=>e)).length&&this._rule["途中流局あり"])){let i=e.shoupai.map((e=>e.toString()));return this.delay((()=>this.pingju("四家立直",i)))}if(this._diyizimo&&3==e.lunban&&(this._diyizimo=!1,this._fengpai))return this.delay((()=>this.pingju("四風連打")),0);if(4==this._n_gang.reduce(((e,i)=>e+i))&&Math.max(...this._n_gang)<4&&this._rule["途中流局あり"])return this.delay((()=>this.pingju("四開槓")),0);if(!e.shan.paishu){let e=["","","",""];for(let i=0;i<4;i++){let t=this.get_reply(i);t.daopai&&(e[i]=t.daopai)}return this.delay((()=>this.pingju("",e)),0)}for(let i=1;i<4;i++){let t=(e.lunban+i)%4,a=this.get_reply(t);if(a.fulou){let e=a.fulou.replace(/0/g,"5");if(e.match(/^[mpsz](\d)\1\1\1/)){if(this.get_gang_mianzi(t).find((e=>e==a.fulou))){this._view&&this._view.say("gang",t);for(let e=0;e<4;e++)this._players[e]._hwnd&&s([this._players[e]._hwnd,"say",this._model.player[this._model.player_id[t]],"kan"]);return this.delay((()=>this.fulou(a.fulou)))}}else if(e.match(/^[mpsz](\d)\1\1/)&&this.get_peng_mianzi(t).find((e=>e==a.fulou))){this._view&&this._view.say("peng",t);for(let e=0;e<4;e++)this._players[e]._hwnd&&s([this._players[e]._hwnd,"say",this._model.player[this._model.player_id[t]],"pon"]);return this.delay((()=>this.fulou(a.fulou)))}}}let i=(e.lunban+1)%4,t=this.get_reply(i);if(t.fulou&&this.get_chi_mianzi(i).find((e=>e==t.fulou))){this._view&&this._view.say("chi",i);for(let e=0;e<4;e++)this._players[e]._hwnd&&s([this._players[e]._hwnd,"say",this._model.player[this._model.player_id[i]],"chi"]);return this.delay((()=>this.fulou(t.fulou)))}this.delay((()=>this.zimo()),0)}}class o extends Majiang.AI{to_ump(e){let i="",t="";for(let a=0;a<e.length;a++){let s=e.substring(a,a+1);s.match(/[_\*\-+=]/)||(s.match(/\d/)?i+=s.replace(/0/,"5")+t:t=s)}return i}from_ump(e){let i="",t="",a=-1;for(let s=0;s<e.length;s++){let l=e.substring(s,s+1);l.match(/\d/)?a=1*l:l.match(/[mpsz]/)&&(t==l?i+=a:(t=l,i+=t+a))}return i}replace_zero_if_none(e){let i=e;return"m5"==e&&0==this.shoupai._bingpai.m[5]?i="m0":"p5"==e&&0==this.shoupai._bingpai.p[5]?i="p0":"s5"==e&&0==this.shoupai._bingpai.s[5]&&(i="s0"),i}kaiju(e){super.kaiju(e),this._hwnd&&s([this._hwnd,"gamestart",["東","南","西","北"][(4+this._id-e.qijia)%4],e.player[0],e.player[1],e.player[2],e.player[3]])}qipai(e){super.qipai(e);const i=(4+this._model.menfeng(this._id)-this._id+this._model.qijia)%4,t=[this._model.player[(4-i)%4],this._model.player[(5-i)%4],this._model.player[(6-i)%4],this._model.player[(7-i)%4]];this._hwnd&&(s([this._hwnd,"kyokustart",["東","南","西","北"][e.zhuangfeng],t[this._model.qijia],e.changbang,1e3*e.lizhibang]),s([this._hwnd,"dora",this.to_ump(e.baopai)]),s([this._hwnd,"haipai",this._model.player[this._id],this.to_ump(this.shoupai.toString())]))}zimo(e,i){super.zimo(e,i);const t=(4+this._model.menfeng(this._id)-this._id+this._model.qijia)%4,a=[this._model.player[(4-t)%4],this._model.player[(5-t)%4],this._model.player[(6-t)%4],this._model.player[(7-t)%4]];this._hwnd&&e.l==this._model.menfeng(this._id)&&s([this._hwnd,"tsumo",a[(this._model.qijia+e.l)%4],this.shan.paishu,this.to_ump(e.p)])}dapai(e){super.dapai(e);const i=(4+this._model.menfeng(this._id)-this._id+this._model.qijia)%4,t=[this._model.player[(4-i)%4],this._model.player[(5-i)%4],this._model.player[(6-i)%4],this._model.player[(7-i)%4]];this._hwnd&&s([this._hwnd,"sutehai",t[(this._model.qijia+e.l)%4],this.to_ump(e.p)])}fulou(e){super.fulou(e);const i=(4+this._model.menfeng(this._id)-this._id+this._model.qijia)%4,t=[this._model.player[(4-i)%4],this._model.player[(5-i)%4],this._model.player[(6-i)%4],this._model.player[(7-i)%4]];this._hwnd&&s([this._hwnd,"open",t[(this._model.qijia+e.l)%4],this.to_ump(e.m)])}gang(e){super.gang(e);const i=(4+this._model.menfeng(this._id)-this._id+this._model.qijia)%4,t=[this._model.player[(4-i)%4],this._model.player[(5-i)%4],this._model.player[(6-i)%4],this._model.player[(7-i)%4]];this._hwnd&&(e.m.match(/^[mpsz]\d{4}/)?s([this._hwnd,"open",t[(this._model.qijia+e.l)%4],this.to_ump(e.m)]):s([this._hwnd,"open",t[(this._model.qijia+e.l)%4],this.to_ump(e.m.substr(0,2))]))}kaigang(e){super.kaigang(e),this._hwnd&&s([this._hwnd,"dora",this.to_ump(e.baopai)])}hule(e){super.hule(e);const i=(4+this._model.menfeng(this._id)-this._id+this._model.qijia)%4,t=[this._model.player[(4-i)%4],this._model.player[(5-i)%4],this._model.player[(6-i)%4],this._model.player[(7-i)%4]];if(this._hwnd){s([this._hwnd,"agari",t[(e.l+this._model.qijia)%4],e.fu]),e.fubaopai&&s([this._hwnd,"dora",this.to_ump(e.fubaopai.join(""))]);for(let i=0;i<4;i++)e.fenpei[i]&&s([this._hwnd,"point",t[(i+this._model.qijia)%4],e.fenpei[i]>0?"+":"-",Math.abs(e.fenpei[i])]);s([this._hwnd,"kyokuend"])}}pingju(e){super.pingju(e);const i=(4+this._model.menfeng(this._id)-this._id+this._model.qijia)%4,t=[this._model.player[(4-i)%4],this._model.player[(5-i)%4],this._model.player[(6-i)%4],this._model.player[(7-i)%4]];if(this._hwnd){s([this._hwnd,"ryukyoku"]);for(let i=0;i<4;i++)e.fenpei[i]&&s([this._hwnd,"point",t[(i+this._model.qijia)%4],e.fenpei[i]>0?"+":"-",Math.abs(e.fenpei[i])]);s([this._hwnd,"kyokuend"])}}jieju(e){super.jieju(e);const i=this._model.player;this._hwnd&&s([this._hwnd,"gameend",i[0]+String.fromCharCode(1)+e.defen[0],i[1]+String.fromCharCode(1)+e.defen[1],i[2]+String.fromCharCode(1)+e.defen[2],i[3]+String.fromCharCode(1)+e.defen[3]])}}}},i={};function t(a){var s=i[a];if(void 0!==s)return s.exports;var l=i[a]={exports:{}};return e[a](l,l.exports,t),l.exports}t.d=(e,i)=>{for(var a in i)t.o(i,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:i[a]})},t.o=(e,i)=>Object.prototype.hasOwnProperty.call(e,i),(()=>{var e=t(835);
/*!
 *  電脳麻将 v2.0.5
 *
 *  Copyright(C) 2017 Satoshi Kobayashi
 *  Released under the MIT license
 *  https://github.com/kobalab/Majiang/blob/master/LICENSE
 */const{hide:i,show:a,fadeIn:s,scale:l,setSelector:n,clearSelector:h}=Majiang.UI.Util;let o;$((function(){let t;const r=Majiang.UI.pai($("#loaddata")),d=Majiang.UI.audio($("#loaddata")),_=e=>($("body").addClass("analyzer"),new Majiang.UI.Analyzer($("#board > .analyzer"),e,r,(()=>$("body").removeClass("analyzer")))),p=new Majiang.UI.PaipuFile($("#file"),"Majiang.game",(e=>($("body").attr("class","board"),l($("#board"),$("#space")),new Majiang.UI.Paipu($("#board"),e,r,d,"Majiang.pref",(()=>s($("body").attr("class","file"))),_))),(e=>(s($("body").attr("class","stat")),new Majiang.UI.PaipuStat($("#stat"),e,(()=>s($("body").attr("class","file"))))))),u=Majiang.rule(JSON.parse(localStorage.getItem("Majiang.rule")||"{}"));async function m(){const[i,a]=await(0,e.B0)();let s=[new Majiang.UI.Player($("#board"),r,d)];for(let i=1;i<4;i++)s[i]=new e.B_;t=new e._P(s,g,u,null,i,a),t.view=new Majiang.UI.Board($("#board .board"),r,d,t.model),$("body").attr("class","board"),l($("#board"),$("#space")),new Majiang.UI.GameCtl($("#board"),t,"Majiang.pref"),t.kaiju()}function g(e){e&&p.add(e,10),s($("body").attr("class","file")),p.redraw()}$("#file .start").on("click",m),$(window).on("resize",(()=>l($("#board"),$("#space")))),$(window).on("load",(function(){i($("#title .loading")),$("#title .start").attr("tabindex",0).attr("role","button").on("click",(()=>{h("title"),p.isEmpty?m():g()})),a(n($("#title .start"),"title",{focus:null,touch:!1}))})),o&&$(window).trigger("load")})),$(window).on("load",(()=>o=!0))})()})();